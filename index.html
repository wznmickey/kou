<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <title>扣</title>
</head>

<body>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.9.0/dist/av-min.js"></script>
    <div style="text-align: center;">
        <progress id="file" style="height: 2vh;width: 50vw;">
        </progress>
        <p id="money" style="font-size:3em">正在加载</p>
        <p><img src="img/logo.png"></p>
        <p><img src="img/wx.jpg" style="height: 25vh">&nbsp;&nbsp;<img src="img/zfb.jpg" style="height: 25vh"></p>
        <p style="font-size: 4em">微&emsp;信&nbsp;支付宝</p>
        <button id="collect" onclick="collect()" style="font-size: xx-large;">填写信息</button>
        <table id="donator" style="text-align:center;margin:auto;font-size: xx-large;">
            <tr>
                <th>&emsp;&emsp;捐助者&emsp;&emsp;</th>
                <th>&emsp;&emsp;捐助金额&emsp;&emsp;</th>
                <th>&emsp;&emsp;捐助时间&emsp;&emsp;</th>
            </tr>
        </table>
    </div>
    <script>
        function collect() {
            window.location.href = "./collect.html";
        }
        AV.init({
            appId: "OwNd3b8n9D9DYb3ApIeQk5FD-9Nh9j0Va",
            appKey: "3djw6bxOwueACjIh6COzUz80",
            serverURL: "https://kouapi.wznmickey.com"
        });
        tableNode = document.getElementById("donator");
        var donator_num = 0;
        var donatedmoney = 0;
        var aimmoney = 0;
        const Qmoney = new AV.Query('Money');
        Qmoney.find().then((money) => {
            aimmoney = money[0].get('money');
        });
        const Qdonator = new AV.Query('donator');
        Qdonator.count().then((count) => {
            donator_num = count;
            Qdonator.ascending('time');
            Qdonator.find().then((money) => {
                for (var i = 0; i < donator_num; i++) {
                    donatedmoney = donatedmoney + money[i].get('money');
                    var trNode = tableNode.insertRow();
                    var tdNode = trNode.insertCell();
                    tdNode.innerHTML = money[i].get('Name');
                    var tdNode = trNode.insertCell();
                    tdNode.innerHTML = money[i].get('money') + "元";
                    var tdNode = trNode.insertCell();
                    tdNode.innerHTML = money[i].get('time').getFullYear() + "年" + (money[i].get('time').getMonth() + 1) + "月" + money[i].get('time').getDate() + "日";
                }
                document.getElementById("money").innerHTML = "当前金额：" + donatedmoney + "/" + aimmoney;
                document.getElementById("file").max = aimmoney;
                document.getElementById("file").value = donatedmoney;
            });
        });
    </script>
</body>

</html>